---
title: UI æ‰©å±•å¼€å‘æŒ‡å—
description: ä»‹ç»VeAIOpsçš„å‰ç«¯UIæ‰©å±•å¼€å‘
navigation:
  icon: i-lucide-layout-dashboard
---

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åŸºäº VeAIOps å‰ç«¯æ¶æ„,å¿«é€Ÿå®ç° UI åŠŸèƒ½æ‰©å±•ã€‚æ— è®ºæ˜¯æ·»åŠ æ–°çš„ä¼ä¸šååŒå·¥å…·æ”¯æŒã€æ¥å…¥æ–°çš„ç›‘æ§ç³»ç»Ÿ,è¿˜æ˜¯å¼€å‘å…¨æ–°çš„ç®¡ç†é¡µé¢,æœ¬æ–‡æ¡£éƒ½å°†ä¸ºæ‚¨æä¾›å®Œæ•´çš„å¼€å‘æŒ‡å¯¼ã€‚

---

## å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ UI æ‰©å±•å¼€å‘ä¹‹å‰,æ‚¨éœ€è¦å…·å¤‡ä»¥ä¸‹çŸ¥è¯†å’Œç¯å¢ƒ:

### æŠ€æœ¯æ ˆè¦æ±‚

- **React 18+**: ç†Ÿæ‚‰ React Hooksã€ç»„ä»¶åŒ–å¼€å‘
- **TypeScript 5+**: æŒæ¡ TypeScript ç±»å‹ç³»ç»Ÿ
- **Modern.js**: äº†è§£ç°ä»£åŒ–çš„ Web æ¡†æ¶
- **pnpm**: åŒ…ç®¡ç†å·¥å…·
- **Nx Workspace**: Monorepo ç®¡ç†å·¥å…·

### å¼€å‘ç¯å¢ƒ

```bash
# Node.js ç‰ˆæœ¬
node >= 18.0.0

# pnpm ç‰ˆæœ¬
pnpm >= 8.0.0

# æ¨èä½¿ç”¨çš„ç¼–è¾‘å™¨
VSCode + TypeScript Extension
```

---

## é¡¹ç›®ç»“æ„æ¦‚è§ˆ

VeAIOps å‰ç«¯é‡‡ç”¨ Nx Workspace Monorepo æ¶æ„,ä»£ç ç»„ç»‡æ¸…æ™°,ä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚

### æ ¸å¿ƒç›®å½•ç»“æ„

```
frontend/
â”œâ”€â”€ apps/                                    # åº”ç”¨ç›®å½•
â”‚   â””â”€â”€ veaiops/                            # ä¸»åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ modules/                    # ä¸šåŠ¡æ¨¡å—ï¼ˆæŒ‰é¢†åŸŸåˆ’åˆ†ï¼‰
â”‚       â”‚   â”‚   â”œâ”€â”€ system/                 # ç³»ç»Ÿé…ç½®æ¨¡å—
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ features/           # åŠŸèƒ½ç‰¹æ€§
â”‚       â”‚   â”‚   â”‚       â”œâ”€â”€ bot/            # æœºå™¨äººç®¡ç†
â”‚       â”‚   â”‚   â”‚       â”œâ”€â”€ datasource/     # æ•°æ®æºç®¡ç†
â”‚       â”‚   â”‚   â”‚       â”œâ”€â”€ account/        # è´¦å·ç®¡ç†
â”‚       â”‚   â”‚   â”‚       â””â”€â”€ ...             # å…¶ä»–åŠŸèƒ½
â”‚       â”‚   â”‚   â”œâ”€â”€ event-center/           # äº‹ä»¶ä¸­å¿ƒæ¨¡å—
â”‚       â”‚   â”‚   â””â”€â”€ threshold/              # æ™ºèƒ½é˜ˆå€¼æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ pages/                      # é¡µé¢å…¥å£
â”‚       â”‚   â”œâ”€â”€ components/                 # åº”ç”¨çº§ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶
â”‚       â”‚   â””â”€â”€ ...
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ packages/                               # å…±äº«åŒ…
â”‚   â”œâ”€â”€ components/                         # UI ç»„ä»¶åº“ â­
â”‚   â”œâ”€â”€ hooks/                              # å…±äº« Hooks
â”‚   â”œâ”€â”€ types/                              # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/                              # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ constants/                          # å¸¸é‡å®šä¹‰
â”œâ”€â”€ nx.json                                 # Nx é…ç½®
â”œâ”€â”€ tsconfig.base.json                      # TypeScript é…ç½®
â””â”€â”€ package.json
```

### æ¨¡å—åŒ–æ¶æ„

VeAIOps é‡‡ç”¨ **Feature-Based** æ¨¡å—åŒ–æ¶æ„,æ¯ä¸ªåŠŸèƒ½ç‰¹æ€§ï¼ˆFeatureï¼‰éƒ½éµå¾ªç»Ÿä¸€çš„ç›®å½•ç»“æ„:

```
features/[feature-name]/
â”œâ”€â”€ hooks/                          # ä¸šåŠ¡é€»è¾‘ Hooks
â”‚   â”œâ”€â”€ use-xxx-logic.ts           # ä¸»ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ use-xxx-table-config.ts    # è¡¨æ ¼é…ç½®
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ lib/                            # å·¥å…·å’Œé…ç½®
â”‚   â”œâ”€â”€ api.ts                     # API è°ƒç”¨
â”‚   â”œâ”€â”€ types.ts                   # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ constants.ts               # å¸¸é‡
â”‚   â”œâ”€â”€ columns.tsx                # è¡¨æ ¼åˆ—é…ç½®
â”‚   â”œâ”€â”€ filters.ts                 # ç­›é€‰å™¨é…ç½®
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ ui/                             # UI ç»„ä»¶
â”‚   â”œâ”€â”€ components/                # å­ç»„ä»¶
â”‚   â”œâ”€â”€ xxx-management.tsx         # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ xxx-table.tsx              # è¡¨æ ¼ç»„ä»¶
â”‚   â”œâ”€â”€ xxx-modal.tsx              # å¼¹çª—ç»„ä»¶
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ types/                          # ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ index.ts                        # ç»Ÿä¸€å¯¼å‡º
```

::alert{type="info"}
#title
æ¶æ„ä¼˜åŠ¿
#description
- **å…³æ³¨ç‚¹åˆ†ç¦»**: ä¸šåŠ¡é€»è¾‘ã€UIã€æ•°æ®åˆ†ç¦»
- **é«˜å¯å¤ç”¨æ€§**: ç»Ÿä¸€çš„æ¨¡å¼ä¾¿äºå¤ç”¨å’Œç»´æŠ¤
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- **æ˜“äºæµ‹è¯•**: æ¸…æ™°çš„åˆ†å±‚ä¾¿äºå•å…ƒæµ‹è¯•
::

---

## Quick Start: å®æˆ˜æ¡ˆä¾‹ - æ·»åŠ æ–°çš„æ•°æ®æºæ”¯æŒ

::alert{type="success"}
#title
è¾¹å­¦è¾¹åšï¼Œå¿«é€Ÿä¸Šæ‰‹
#description
é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹ï¼Œå¿«é€Ÿäº†è§£ VeAIOps å‰ç«¯å¼€å‘çš„å®Œæ•´æµç¨‹ã€‚å»ºè®®å…ˆè·Ÿéšæœ¬æ¡ˆä¾‹åŠ¨æ‰‹å®è·µï¼Œå†æ·±å…¥å­¦ä¹ åç»­çš„è¯¦ç»†ç« èŠ‚ã€‚
::

æœ¬èŠ‚å°†ä»¥æ·»åŠ  Prometheus æ•°æ®æºä¸ºä¾‹ï¼Œæ¼”ç¤ºä»åç«¯ API åˆ°å‰ç«¯ UI çš„å®Œæ•´æ‰©å±•æµç¨‹ã€‚

### åœºæ™¯è¯´æ˜

å‡è®¾æˆ‘ä»¬éœ€è¦åœ¨ VeAIOps ä¸­æ·»åŠ  Prometheus ç›‘æ§æ•°æ®æºçš„æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ UI ç•Œé¢é…ç½® Prometheus è¿æ¥ï¼Œå¹¶æŸ¥çœ‹ç›¸å…³æŒ‡æ ‡ã€‚

**æœ€ç»ˆæ•ˆæœé¢„è§ˆ**:

![æ•°æ®æºç®¡ç†é¡µé¢](/veaiops/images/datasource-instance.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”¨æˆ·å¯ä»¥åœ¨æ•°æ®æºç®¡ç†é¡µé¢æŸ¥çœ‹æ‰€æœ‰é…ç½®çš„æ•°æ®æºï¼ŒåŒ…æ‹¬æ•°æ®æºåç§°ã€ç±»å‹ã€é…ç½®ä¿¡æ¯ç­‰ã€‚

### åç«¯å‡†å¤‡

åœ¨å¼€å§‹å‰ç«¯å¼€å‘ä¹‹å‰ï¼Œç¡®ä¿åç«¯å·²ç»å®ç°äº†ç›¸å…³ API:

```python [veaiops/metrics/prometheus.py]
from veaiops.metrics.base import DataSource

class PrometheusDataSource(DataSource):
    """Prometheus æ•°æ®æºå®ç°"""

    async def _fetch_one_slot(self, start_time, end_time):
        # å®ç°æ•°æ®è·å–é€»è¾‘
        pass
```

::alert{type="info"}
åç«¯å®ç°è¯·å‚è€ƒ [å¼€å‘æŒ‡å—](/development/development) ä¸­çš„"å®ç°æ–°çš„ç›‘æ§æ•°æ®æº"ç« èŠ‚ã€‚
::

### å‰ç«¯å®ç°æ­¥éª¤

å®Œæ•´çš„å¼€å‘æµç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤:

::steps
**å®šä¹‰ OpenAPI Spec** - å®šä¹‰ API æ¥å£è§„èŒƒ
**ç”Ÿæˆ API ä»£ç ** - è‡ªåŠ¨ç”Ÿæˆ TypeScript ä»£ç 
**åˆ›å»º Feature ç›®å½•** - ç»„ç»‡ä»£ç ç»“æ„
**å®ç°ä¸šåŠ¡é€»è¾‘** - ç¼–å†™æ ¸å¿ƒåŠŸèƒ½
**åˆ›å»º UI ç»„ä»¶** - æ„å»ºç”¨æˆ·ç•Œé¢
**é…ç½®è·¯ç”±** - æ·»åŠ é¡µé¢è·¯ç”±
**æµ‹è¯•éªŒè¯** - ç¡®ä¿åŠŸèƒ½æ­£å¸¸
::

#### æ­¥éª¤ 1: å®šä¹‰ OpenAPI Spec

é¦–å…ˆåœ¨ `frontend/packages/openapi-specs/src/specs/modules/` ç›®å½•ä¸‹åˆ›å»º `prometheus.json`:

```json [frontend/packages/openapi-specs/src/specs/modules/prometheus.json]
{
  "openapi": "3.0.0",
  "info": {
    "title": "Prometheus API",
    "version": "1.0.0",
    "description": "Prometheus æ•°æ®æºç®¡ç†æ¥å£"
  },
  "paths": {
    "/apis/v1/datasource/prometheus/": {
      "get": {
        "summary": "Get All Prometheus Datasources",
        "tags": ["Data Sources"],
        "parameters": [
          {
            "name": "skip",
            "in": "query",
            "schema": { "type": "integer", "default": 0 }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": { "type": "integer", "default": 100 }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/PrometheusDataSource" }
                    },
                    "total": { "type": "integer" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "PrometheusDataSource": {
        "type": "object",
        "properties": {
          "_id": { "type": "string" },
          "name": { "type": "string" },
          "prometheus_config": {
            "type": "object",
            "properties": {
              "server_url": { "type": "string" },
              "query_timeout": { "type": "integer" }
            }
          }
        }
      }
    }
  }
}
```

#### æ­¥éª¤ 2: ç”Ÿæˆ API ä»£ç 

è¿è¡Œç”Ÿæˆå‘½ä»¤:

```bash
cd frontend
pnpm generate:api
```

è¿™å°†åœ¨ `frontend/apps/veaiops/api-generate/` ç›®å½•ä¸‹ç”Ÿæˆ:
- `models/PrometheusDataSource.ts` - ç±»å‹å®šä¹‰
- `services/DataSourcesService.ts` - API æœåŠ¡ç±»

#### æ­¥éª¤ 3: åˆ›å»º Feature ç›®å½•

```bash
cd frontend/apps/veaiops/src/modules/system/features/
mkdir -p prometheus/{hooks,lib,ui,types}
```

#### æ­¥éª¤ 4: å®šä¹‰ç±»å‹å’Œå¸¸é‡

::alert{type="success"}
ç”±äºå·²ç»é€šè¿‡ OpenAPI spec ç”Ÿæˆäº†ç±»å‹å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ `api-generate` ä¸­çš„ç±»å‹ï¼Œæ— éœ€é‡å¤å®šä¹‰ã€‚
::

```typescript [prometheus/lib/types.ts]
/**
 * Prometheus æ•°æ®æºé…ç½®
 */
export interface PrometheusDataSource {
  _id: string;
  name: string;
  type: 'Prometheus';
  is_active: boolean;
  prometheus_config: {
    server_url: string;
    query_timeout?: number;
    basic_auth?: {
      username: string;
      password: string;
    };
  };
  description?: string;
  created_at: string;
  updated_at: string;
}

/**
 * Prometheus è¡¨å•æ•°æ®
 */
export interface PrometheusFormData {
  name: string;
  server_url: string;
  query_timeout?: number;
  username?: string;
  password?: string;
  description?: string;
}
```

```typescript [prometheus/lib/constants.ts]
/**
 * é»˜è®¤é…ç½®
 */
export const DEFAULT_QUERY_TIMEOUT = 30; // ç§’

/**
 * è¡¨å•éªŒè¯è§„åˆ™
 */
export const VALIDATION_RULES = {
  server_url: {
    required: true,
    pattern: /^https?:\/\/.+/,
    message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„ URL',
  },
  name: {
    required: true,
    message: 'è¯·è¾“å…¥æ•°æ®æºåç§°',
  },
};
```

#### æ­¥éª¤ 5: ä½¿ç”¨ç”Ÿæˆçš„ API ä»£ç 

ç›´æ¥ä½¿ç”¨ `api-generate` ä¸­ç”Ÿæˆçš„ API æœåŠ¡:

```typescript [prometheus/lib/api.ts]
import { DataSourcesService } from 'api-generate';
import type { PrometheusDataSource } from 'api-generate';

/**
 * è·å– Prometheus æ•°æ®æºåˆ—è¡¨
 */
export const getPrometheusDataSources = async (params: {
  skip?: number;
  limit?: number;
  name?: string;
}) => {
  // ç›´æ¥ä½¿ç”¨ç”Ÿæˆçš„æœåŠ¡ï¼ŒåŒ…å«å®Œæ•´çš„ç±»å‹æ”¯æŒ
  const response = await DataSourcesService.getAllPrometheusDatasources({
    skip: params.skip,
    limit: params.limit,
    name: params.name,
  });

  return {
    data: response.items || [],
    total: response.total || 0,
    success: true,
  };
};

/**
 * åˆ›å»º Prometheus æ•°æ®æº
 */
export const createPrometheusDataSource = async (data: {
  name: string;
  server_url: string;
  query_timeout?: number;
  description?: string;
}) => {
  return await DataSourcesService.createPrometheusDatasource({
    requestBody: {
      type: 'Prometheus',
      name: data.name,
      description: data.description,
      prometheus_config: {
        server_url: data.server_url,
        query_timeout: data.query_timeout || 30,
      },
    },
  });
};

/**
 * åˆ é™¤ Prometheus æ•°æ®æº
 */
export const deletePrometheusDataSource = async (id: string) => {
  return await DataSourcesService.deletePrometheusDatasource({ id });
};

/**
 * æµ‹è¯• Prometheus è¿æ¥
 */
export const testPrometheusConnection = async (id: string) => {
  return await DataSourcesService.testPrometheusDatasource({ id });
};
```

::alert{type="success"}
#title
ç±»å‹å®‰å…¨ä¼˜åŠ¿
#description
ä½¿ç”¨ç”Ÿæˆçš„ API ä»£ç å¯ä»¥è·å¾—å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒï¼Œç¼–è¾‘å™¨ä¼šè‡ªåŠ¨æç¤ºå‚æ•°ç±»å‹ã€å“åº”æ ¼å¼ç­‰ï¼Œå‡å°‘é”™è¯¯ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚
::

#### æ­¥éª¤ 6: é…ç½®è¡¨æ ¼åˆ—

```typescript [prometheus/lib/columns.tsx]
import { Button, Tag, Space, Popconfirm } from '@arco-design/web-react';
import { IconEdit, IconDelete, IconLink } from '@arco-design/web-react/icon';
import type { ColumnProps } from '@arco-design/web-react/es/Table';
import { CellRender } from '@veaiops/components';
import type { PrometheusDataSource } from './types';

interface ColumnsProps {
  onEdit: (record: PrometheusDataSource) => void;
  onDelete: (id: string) => Promise<void>;
  onTest: (record: PrometheusDataSource) => void;
}

export const getPrometheusColumns = ({
  onEdit,
  onDelete,
  onTest,
}: ColumnsProps): ColumnProps<PrometheusDataSource>[] => [
  {
    title: 'æ•°æ®æºåç§°',
    dataIndex: 'name',
    key: 'name',
    fixed: 'left' as const,
    width: 200,
    render: (name: string, record: PrometheusDataSource) => (
      <CellRender.InfoWithCode name={name} code={record._id} />
    ),
  },
  {
    title: 'Prometheus åœ°å€',
    dataIndex: ['prometheus_config', 'server_url'],
    key: 'server_url',
    width: 300,
    render: (url: string) => <CellRender.Ellipsis text={url} />,
  },
  {
    title: 'æŸ¥è¯¢è¶…æ—¶',
    dataIndex: ['prometheus_config', 'query_timeout'],
    key: 'query_timeout',
    width: 120,
    render: (timeout: number) => `${timeout || 30}s`,
  },
  {
    title: 'è®¤è¯æ–¹å¼',
    dataIndex: ['prometheus_config', 'basic_auth'],
    key: 'auth',
    width: 120,
    render: (auth: any) => (
      <Tag color={auth ? 'green' : 'gray'}>
        {auth ? 'Basic Auth' : 'æ— è®¤è¯'}
      </Tag>
    ),
  },
  {
    title: 'æè¿°',
    dataIndex: 'description',
    key: 'description',
    width: 200,
    render: (desc: string) => <CellRender.Ellipsis text={desc || '-'} />,
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'created_at',
    key: 'created_at',
    width: 180,
    render: (time: string) => <CellRender.StampTime time={time} />,
  },
  {
    title: 'æ“ä½œ',
    key: 'actions',
    fixed: 'right' as const,
    width: 200,
    render: (_: any, record: PrometheusDataSource) => (
      <Space size="small">
        <Button
          type="text"
          size="small"
          icon={<IconLink />}
          onClick={() => onTest(record)}
        >
          æµ‹è¯•è¿æ¥
        </Button>
        <Button
          type="text"
          size="small"
          icon={<IconEdit />}
          onClick={() => onEdit(record)}
        >
          ç¼–è¾‘
        </Button>
        <Popconfirm
          title="ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ•°æ®æºå—ï¼Ÿ"
          onOk={() => onDelete(record._id)}
        >
          <Button type="text" size="small" status="danger" icon={<IconDelete />}>
            åˆ é™¤
          </Button>
        </Popconfirm>
      </Space>
    ),
  },
];
```

#### æ­¥éª¤ 7: é…ç½®ç­›é€‰å™¨

```typescript [prometheus/lib/filters.ts]
import type { FilterConfig } from '@veaiops/components';

export const prometheusFilters: FilterConfig[] = [
  {
    field: 'name',
    label: 'æ•°æ®æºåç§°',
    type: 'Input',
    componentProps: {
      placeholder: 'è¯·è¾“å…¥æ•°æ®æºåç§°',
      allowClear: true,
    },
  },
  {
    field: 'server_url',
    label: 'Prometheus åœ°å€',
    type: 'Input',
    componentProps: {
      placeholder: 'è¯·è¾“å…¥ Prometheus åœ°å€',
      allowClear: true,
    },
  },
];
```

#### æ­¥éª¤ 8: åˆ›å»ºè¡¨æ ¼é…ç½® Hook

```typescript [prometheus/hooks/use-prometheus-table-config.ts]
import { useCallback } from 'react';
import { useBusinessTable } from '@veaiops/components';
import { Message } from '@arco-design/web-react';
import {
  getPrometheusDataSources,
  deletePrometheusDataSource,
} from '../lib/api';
import { getPrometheusColumns } from '../lib/columns';
import type { PrometheusDataSource } from '../lib/types';

export const usePrometheusTableConfig = ({
  onEdit,
  onTest,
}: {
  onEdit: (record: PrometheusDataSource) => void;
  onTest: (record: PrometheusDataSource) => void;
}) => {
  const request = useCallback(
    async (params: { current: number; pageSize: number; [key: string]: any }) => {
      const { current, pageSize, ...filters } = params;

      const response = await getPrometheusDataSources({
        skip: (current - 1) * pageSize,
        limit: pageSize,
        ...filters,
      });

      return {
        data: response.data,
        total: response.total || 0,
        success: true,
      };
    },
    [],
  );

  const handleDelete = useCallback(async (id: string) => {
    try {
      await deletePrometheusDataSource(id);
      Message.success('åˆ é™¤æˆåŠŸ');
      return true;
    } catch (error) {
      Message.error('åˆ é™¤å¤±è´¥');
      return false;
    }
  }, []);

  const { customTableProps } = useBusinessTable({
    dataSource: { request },
    handlers: { delete: handleDelete },
    refreshConfig: {
      enableRefreshFeedback: true,
    },
  });

  const columns = useCallback(
    () => getPrometheusColumns({ onEdit, onDelete: handleDelete, onTest }),
    [onEdit, handleDelete, onTest],
  );

  return {
    ...customTableProps,
    handleColumns: columns,
  };
};
```

#### æ­¥éª¤ 9: åˆ›å»ºä¸šåŠ¡é€»è¾‘ Hook

```typescript [prometheus/hooks/use-prometheus-logic.ts]
import { useState, useCallback } from 'react';
import { Form, Message } from '@arco-design/web-react';
import {
  createPrometheusDataSource,
  updatePrometheusDataSource,
  testPrometheusConnection,
} from '../lib/api';
import type { PrometheusDataSource, PrometheusFormData } from '../lib/types';

export const usePrometheusLogic = (refreshTable?: () => void) => {
  const [form] = Form.useForm();
  const [modalVisible, setModalVisible] = useState(false);
  const [editingDataSource, setEditingDataSource] =
    useState<PrometheusDataSource | null>(null);
  const [loading, setLoading] = useState(false);
  const [testing, setTesting] = useState(false);

  const handleAdd = useCallback(() => {
    setEditingDataSource(null);
    form.resetFields();
    setModalVisible(true);
  }, [form]);

  const handleEdit = useCallback(
    (record: PrometheusDataSource) => {
      setEditingDataSource(record);
      form.setFieldsValue({
        name: record.name,
        server_url: record.prometheus_config.server_url,
        query_timeout: record.prometheus_config.query_timeout,
        username: record.prometheus_config.basic_auth?.username,
        description: record.description,
      });
      setModalVisible(true);
    },
    [form],
  );

  const handleCancel = useCallback(() => {
    setModalVisible(false);
    setEditingDataSource(null);
    form.resetFields();
  }, [form]);

  const handleSubmit = useCallback(
    async (values: PrometheusFormData) => {
      setLoading(true);
      try {
        if (editingDataSource) {
          await updatePrometheusDataSource(editingDataSource._id, values);
          Message.success('æ›´æ–°æˆåŠŸ');
        } else {
          await createPrometheusDataSource(values);
          Message.success('åˆ›å»ºæˆåŠŸ');
        }
        handleCancel();
        refreshTable?.();
      } catch (error) {
        Message.error(editingDataSource ? 'æ›´æ–°å¤±è´¥' : 'åˆ›å»ºå¤±è´¥');
      } finally {
        setLoading(false);
      }
    },
    [editingDataSource, handleCancel, refreshTable],
  );

  const handleTest = useCallback(
    async (record: PrometheusDataSource) => {
      setTesting(true);
      try {
        const result = await testPrometheusConnection({
          server_url: record.prometheus_config.server_url,
          username: record.prometheus_config.basic_auth?.username,
          password: '', // ä¸ä¼ å¯†ç ï¼Œä½¿ç”¨å·²ä¿å­˜çš„
        });

        if (result.success) {
          Message.success('è¿æ¥æµ‹è¯•æˆåŠŸ');
        } else {
          Message.error(`è¿æ¥æµ‹è¯•å¤±è´¥: ${result.message}`);
        }
      } catch (error) {
        Message.error('è¿æ¥æµ‹è¯•å¤±è´¥');
      } finally {
        setTesting(false);
      }
    },
    [],
  );

  return {
    modalVisible,
    editingDataSource,
    form,
    loading,
    testing,
    handleAdd,
    handleEdit,
    handleCancel,
    handleSubmit,
    handleTest,
  };
};
```

#### æ­¥éª¤ 10: åˆ›å»º UI ç»„ä»¶

```typescript [prometheus/ui/prometheus-table.tsx]
import { forwardRef } from 'react';
import { CustomTable, Filters } from '@veaiops/components';
import { Button, Card } from '@arco-design/web-react';
import { IconPlus } from '@arco-design/web-react/icon';
import { usePrometheusTableConfig } from '../hooks';
import { prometheusFilters } from '../lib/filters';
import type { PrometheusDataSource } from '../lib/types';

interface PrometheusTableProps {
  onEdit: (record: PrometheusDataSource) => void;
  onAdd: () => void;
  onTest: (record: PrometheusDataSource) => void;
}

export const PrometheusTable = forwardRef<any, PrometheusTableProps>(
  (props, ref) => {
    const { onEdit, onAdd, onTest } = props;

    const tableConfig = usePrometheusTableConfig({ onEdit, onTest });

    return (
      <Card
        title="Prometheus æ•°æ®æºç®¡ç†"
        extra={
          <Button type="primary" icon={<IconPlus />} onClick={onAdd}>
            æ–°å¢æ•°æ®æº
          </Button>
        }
      >
        <Filters config={prometheusFilters} showReset />
        <CustomTable
          {...tableConfig}
          ref={ref}
          rowKey="_id"
          scroll={{ x: 1400 }}
        />
      </Card>
    );
  },
);

PrometheusTable.displayName = 'PrometheusTable';
```

```typescript [prometheus/ui/prometheus-modal.tsx]
import {
  Modal,
  Form,
  Input,
  InputNumber,
  TextArea,
} from '@arco-design/web-react';
import type { FormInstance } from '@arco-design/web-react';
import { VALIDATION_RULES, DEFAULT_QUERY_TIMEOUT } from '../lib/constants';
import type { PrometheusFormData } from '../lib/types';

interface PrometheusModalProps {
  visible: boolean;
  form: FormInstance;
  loading: boolean;
  isEdit: boolean;
  onCancel: () => void;
  onSubmit: (values: PrometheusFormData) => void;
}

export const PrometheusModal = ({
  visible,
  form,
  loading,
  isEdit,
  onCancel,
  onSubmit,
}: PrometheusModalProps) => {
  return (
    <Modal
      title={isEdit ? 'ç¼–è¾‘ Prometheus æ•°æ®æº' : 'æ–°å¢ Prometheus æ•°æ®æº'}
      visible={visible}
      onOk={() => form.submit()}
      onCancel={onCancel}
      confirmLoading={loading}
      maskClosable={false}
    >
      <Form
        form={form}
        layout="vertical"
        onSubmit={onSubmit}
        autoComplete="off"
      >
        <Form.Item
          label="æ•°æ®æºåç§°"
          field="name"
          rules={[VALIDATION_RULES.name]}
        >
          <Input placeholder="è¯·è¾“å…¥æ•°æ®æºåç§°" />
        </Form.Item>

        <Form.Item
          label="Prometheus æœåŠ¡åœ°å€"
          field="server_url"
          rules={[VALIDATION_RULES.server_url]}
        >
          <Input placeholder="http://prometheus.example.com:9090" />
        </Form.Item>

        <Form.Item
          label="æŸ¥è¯¢è¶…æ—¶æ—¶é—´ (ç§’)"
          field="query_timeout"
          initialValue={DEFAULT_QUERY_TIMEOUT}
        >
          <InputNumber
            placeholder="è¯·è¾“å…¥è¶…æ—¶æ—¶é—´"
            min={1}
            max={300}
            style={{ width: '100%' }}
          />
        </Form.Item>

        <Form.Item label="ç”¨æˆ·å (å¯é€‰)" field="username">
          <Input placeholder="Basic Auth ç”¨æˆ·å" />
        </Form.Item>

        <Form.Item label="å¯†ç  (å¯é€‰)" field="password">
          <Input.Password placeholder="Basic Auth å¯†ç " />
        </Form.Item>

        <Form.Item label="æè¿°" field="description">
          <TextArea
            placeholder="è¯·è¾“å…¥æ•°æ®æºæè¿°"
            rows={3}
            maxLength={200}
            showWordLimit
          />
        </Form.Item>
      </Form>
    </Modal>
  );
};
```

```typescript [prometheus/ui/prometheus-management.tsx]
import { useRef } from 'react';
import { PrometheusTable } from './prometheus-table';
import { PrometheusModal } from './prometheus-modal';
import { usePrometheusLogic } from '../hooks';

export const PrometheusManagement = () => {
  const tableRef = useRef<any>(null);

  const {
    modalVisible,
    editingDataSource,
    form,
    loading,
    handleAdd,
    handleEdit,
    handleCancel,
    handleSubmit,
    handleTest,
  } = usePrometheusLogic(() => tableRef.current?.refresh());

  return (
    <>
      <PrometheusTable
        ref={tableRef}
        onAdd={handleAdd}
        onEdit={handleEdit}
        onTest={handleTest}
      />
      <PrometheusModal
        visible={modalVisible}
        form={form}
        loading={loading}
        isEdit={!!editingDataSource}
        onCancel={handleCancel}
        onSubmit={handleSubmit}
      />
    </>
  );
};

export default PrometheusManagement;
```

#### æ­¥éª¤ 11: ç»Ÿä¸€å¯¼å‡º

```typescript [prometheus/index.ts]
export { PrometheusManagement } from './ui';
export * from './hooks';
export * from './lib/types';
export * from './lib/constants';
```

#### æ­¥éª¤ 12: é…ç½®è·¯ç”±å’Œé¡µé¢

```typescript [pages/system/prometheus.tsx]
import { lazy } from 'react';

const PrometheusManagement = lazy(
  () => import('@/modules/system/features/prometheus/ui/prometheus-management'),
);

const PrometheusPage = () => {
  return <PrometheusManagement />;
};

export default PrometheusPage;
```

æ›´æ–°è·¯ç”±é…ç½®:

```typescript [config/routes/system-routes.ts]
export const systemRoutes = [
  // ... å…¶ä»–è·¯ç”±
  {
    path: '/system/datasource/prometheus',
    element: React.createElement(pageConfig.system.Prometheus),
    title: 'Prometheus æ•°æ®æº',
    requireAuth: true,
  },
];
```

### æœ€ç»ˆæ•ˆæœå±•ç¤º

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ•°æ®æºç®¡ç†ç³»ç»Ÿã€‚

#### æ•°æ®æºåˆ—è¡¨é¡µé¢

![æ•°æ®æºç®¡ç†é¡µé¢](/veaiops/images/datasource-instance.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•°æ®æºåˆ—è¡¨é¡µé¢åŒ…å«:
- âœ… æ•°æ®æºåˆ—è¡¨å±•ç¤º
- âœ… ç­›é€‰å’Œåˆ†é¡µåŠŸèƒ½
- âœ… æ“ä½œæŒ‰é’®(ç¼–è¾‘ã€åˆ é™¤ã€æµ‹è¯•è¿æ¥)

#### è¿æ¥é…ç½®é¡µé¢

![æ•°æ®æºè¿æ¥é…ç½®](/veaiops/images/datasource-connection.png)

è¿æ¥ç®¡ç†é¡µé¢æ”¯æŒ:
- âœ… å¤šç§æ•°æ®æºç±»å‹
- âœ… å®‰å…¨çš„å‡­è¯ç®¡ç†
- âœ… è¿æ¥æµ‹è¯•åŠŸèƒ½

#### æ•°æ®æºé…ç½®å‘å¯¼

ä¸åŒç±»å‹çš„æ•°æ®æºæœ‰ä¸“é—¨çš„é…ç½®å‘å¯¼:

**ç«å±±å¼•æ“æ•°æ®æº**:
![ç«å±±å¼•æ“é…ç½®å‘å¯¼](/veaiops/images/datasource-volcengine-wizard.png)

**é˜¿é‡Œäº‘æ•°æ®æº**:
![é˜¿é‡Œäº‘é…ç½®å‘å¯¼](/veaiops/images/datasource-aliyun-wizard.png)

**Zabbix æ•°æ®æº**:
![Zabbixé…ç½®å‘å¯¼](/veaiops/images/datasource-zabbix-wizard.png)

::alert{type="success"}
#title
å®Œæ•´åŠŸèƒ½ç‰¹æ€§
#description
- âœ… æ•°æ®æºåˆ—è¡¨å±•ç¤ºå’Œç®¡ç†
- âœ… å¼ºå¤§çš„ç­›é€‰å’Œåˆ†é¡µåŠŸèƒ½
- âœ… åˆ›å»º/ç¼–è¾‘/åˆ é™¤æ•°æ®æº
- âœ… è¿æ¥æµ‹è¯•å’ŒéªŒè¯
- âœ… å®Œæ•´çš„è¡¨å•éªŒè¯
- âœ… å‹å¥½çš„é”™è¯¯å¤„ç†
- âœ… Loading çŠ¶æ€åé¦ˆ
- âœ… å“åº”å¼å¸ƒå±€è®¾è®¡
::

### ä¸‹ä¸€æ­¥å­¦ä¹ 

::alert{type="info"}
#title
ç»§ç»­æ·±å…¥å­¦ä¹ 
#description
å®Œæˆäº†è¿™ä¸ªå¿«é€Ÿå…¥é—¨æ¡ˆä¾‹åï¼Œå»ºè®®ç»§ç»­å­¦ä¹ ä»¥ä¸‹ç« èŠ‚ä»¥æ·±å…¥äº†è§£ VeAIOps å‰ç«¯æ¶æ„ï¼š
- **Nx Workspace å¿«é€Ÿå…¥é—¨** - äº†è§£ Monorepo å·¥å…·é“¾
- **å…±äº«åŒ…è¯¦è§£** - æŒæ¡å¯å¤ç”¨ç»„ä»¶å’Œå·¥å…·
- **æ ¸å¿ƒç»„ä»¶ä½¿ç”¨** - å­¦ä¹  CustomTableã€Filters ç­‰æ ¸å¿ƒç»„ä»¶
- **å¼€å‘æµç¨‹** - äº†è§£å®Œæ•´çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ
::

---

## Nx Workspace å¿«é€Ÿå…¥é—¨

### ä»€ä¹ˆæ˜¯ Nx Workspace?

Nx æ˜¯ä¸€ä¸ªæ™ºèƒ½ã€å¿«é€Ÿã€å¯æ‰©å±•çš„æ„å»ºç³»ç»Ÿ,å¸®åŠ©æ‚¨é«˜æ•ˆç®¡ç† Monorepoã€‚

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… **æ™ºèƒ½ç¼“å­˜**: åªæ„å»ºå˜æ›´çš„éƒ¨åˆ†,æ˜¾è‘—æå‡æ„å»ºé€Ÿåº¦
- âœ… **ä¾èµ–å›¾ç®¡ç†**: è‡ªåŠ¨åˆ†æå’Œç®¡ç†åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»
- âœ… **å¹¶è¡Œæ‰§è¡Œ**: å……åˆ†åˆ©ç”¨å¤šæ ¸CPU,å¹¶è¡Œæ„å»ºå’Œæµ‹è¯•
- âœ… **ä»£ç ç”Ÿæˆ**: æä¾›ä»£ç è„šæ‰‹æ¶,å¿«é€Ÿåˆ›å»ºæ–°æ¨¡å—

### å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘
pnpm dev                    # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev:veaiops            # å¯åŠ¨ä¸»åº”ç”¨

# æ„å»º
pnpm build                  # æ„å»ºæ‰€æœ‰åŒ…å’Œåº”ç”¨
pnpm build:packages         # ä»…æ„å»ºå…±äº«åŒ…
pnpm build:apps             # ä»…æ„å»ºåº”ç”¨

# ä»£ç è´¨é‡
pnpm lint                   # ä»£ç æ£€æŸ¥
pnpm type-check             # ç±»å‹æ£€æŸ¥
pnpm format                 # ä»£ç æ ¼å¼åŒ–

# Nx å·¥å…·
pnpm nx graph               # å¯è§†åŒ–ä¾èµ–å›¾
pnpm nx affected:build      # æ„å»ºå—å½±å“çš„é¡¹ç›®
pnpm nx affected:test       # æµ‹è¯•å—å½±å“çš„é¡¹ç›®
pnpm nx reset               # æ¸…é™¤ç¼“å­˜
```

### åŒ…å¼•ç”¨æ–¹å¼

VeAIOps é€šè¿‡ `tsconfig.base.json` é…ç½®äº†è·¯å¾„åˆ«å,å¯ä»¥ç›´æ¥å¼•ç”¨å…±äº«åŒ…:

```typescript
// å¯¼å…¥ç»„ä»¶åº“
import { CustomTable, Filters, CellRender } from '@veaiops/components';

// å¯¼å…¥ Hooks
import { useTableRefresh } from '@veaiops/hooks';

// å¯¼å…¥ç±»å‹
import type { DataSource } from '@veaiops/types';

// å¯¼å…¥å·¥å…·å‡½æ•°
import { formatDate } from '@veaiops/utils';

// å¯¼å…¥å¸¸é‡
import { API_ENDPOINTS } from '@veaiops/constants';
```

---

## å…±äº«åŒ…è¯¦è§£

VeAIOps å‰ç«¯é‡‡ç”¨ Monorepo æ¶æ„,å°†å¯å¤ç”¨çš„ä»£ç æŠ½è±¡ä¸ºå…±äº«åŒ…ã€‚æœ¬èŠ‚è¯¦ç»†ä»‹ç»æ¯ä¸ªåŒ…çš„ä½œç”¨ã€å†…å®¹å’Œä½¿ç”¨åœºæ™¯ã€‚

### @veaiops/components - UI ç»„ä»¶åº“ â­

**ä½œç”¨**: VeAIOps æ ¸å¿ƒ UI ç»„ä»¶åº“,æä¾›å¯å¤ç”¨çš„ä¸šåŠ¡ç»„ä»¶ã€‚

**ä¸»è¦ç»„ä»¶åˆ†ç±»**:

::tabs
  ::tab{label="è¡¨æ ¼ç»„ä»¶"}
    **CustomTable** - æ ¸å¿ƒè¡¨æ ¼ç»„ä»¶
    - å®Œæ•´çš„æ•°æ®æºç®¡ç†
    - åˆ†é¡µã€æ’åºã€ç­›é€‰
    - æ’ä»¶åŒ–æ¶æ„
    - ç”Ÿå‘½å‘¨æœŸé’©å­
    - åˆ·æ–°æœºåˆ¶

    ```typescript
    import { CustomTable } from '@veaiops/components';

    <CustomTable
      dataSource={{ request: fetchData }}
      baseColumns={columns}
    />
    ```
  ::

  ::tab{label="ç­›é€‰ç»„ä»¶"}
    **Filters** - æ’ä»¶åŒ–ç­›é€‰å™¨
    - åŠ¨æ€é…ç½®
    - æ’ä»¶æ‰©å±•
    - å‘½åç©ºé—´æ”¯æŒ
    - é¢„è®¾é…ç½®

    ```typescript
    import { Filters } from '@veaiops/components';

    <Filters config={filterConfig} query={query} showReset />
    ```
  ::

  ::tab{label="å•å…ƒæ ¼æ¸²æŸ“"}
    **CellRender** - å•å…ƒæ ¼æ¸²æŸ“ç»„ä»¶é›†åˆ
    - `InfoWithCode` - ä¿¡æ¯å±•ç¤º
    - `StampTime` - æ—¶é—´æ ¼å¼åŒ–
    - `Ellipsis` - æ–‡æœ¬çœç•¥
    - `CustomOutlineTag` - æ ‡ç­¾
    - `StatusDot` - çŠ¶æ€ç‚¹
    - `CopyButton` - å¤åˆ¶æŒ‰é’®
    - `Boolean` - å¸ƒå°”å€¼æ˜¾ç¤º
    - `Duration` - æ—¶é•¿æ˜¾ç¤º
    - `Link` - é“¾æ¥æ¸²æŸ“

    ```typescript
    import { CellRender } from '@veaiops/components';

    <CellRender.InfoWithCode name="åç§°" code="ID" />
    <CellRender.StampTime time={timestamp} />
    <CellRender.Ellipsis text={longText} />
    ```
  ::

  ::tab{label="è¡¨å•æ§ä»¶"}
    **Form Control ç³»åˆ—**
    - `SelectComponents.Account` - è´¦æˆ·é€‰æ‹©
    - `SelectComponents.Employee` - å‘˜å·¥é€‰æ‹©
    - `SelectComponents.PSM` - PSM æœåŠ¡é€‰æ‹©
    - `InputComponents.Search` - æœç´¢è¾“å…¥
    - `Cascader` - çº§è”é€‰æ‹©
    - `FormList` - è¡¨å•åˆ—è¡¨

    ```typescript
    import { SelectComponents } from '@veaiops/components';

    <SelectComponents.Account
      value={accountId}
      onChange={handleChange}
    />
    ```
  ::

  ::tab{label="æŒ‰é’®ç»„ä»¶"}
    **Button ç³»åˆ—**
    - `ButtonGroupRender` - æŒ‰é’®ç»„æ¸²æŸ“
    - `CopyButton` - å¤åˆ¶æŒ‰é’®
    - `LoadingButton` - åŠ è½½æŒ‰é’®
    - `PopoverWrapper` - æ°”æ³¡åŒ…è£…å™¨

    ```typescript
    import { ButtonGroupRender } from '@veaiops/components';

    <ButtonGroupRender
      buttonConfigurations={[
        {
          text: 'ç¼–è¾‘',
          onClick: handleEdit,
          buttonProps: { type: 'text' }
        }
      ]}
    />
    ```
  ::

  ::tab{label="å…¶ä»–ç»„ä»¶"}
    - **Card** - å¡ç‰‡ç»„ä»¶ç³»åˆ—
    - **XGuide** - ç”¨æˆ·å¼•å¯¼ç»„ä»¶
    - **CustomFields** - è‡ªå®šä¹‰å­—æ®µ
    - **Tip** - æç¤ºç»„ä»¶
    - **ConfigDiff** - é…ç½®å¯¹æ¯”

    ```typescript
    import { Card, XGuide, Tip } from '@veaiops/components';
    ```
  ::
::

**ä½¿ç”¨åœºæ™¯**:
- âœ… æ„å»ºæ•°æ®ç®¡ç†é¡µé¢
- âœ… å®ç°å¤æ‚è¡¨æ ¼äº¤äº’
- âœ… åˆ›å»ºç­›é€‰å’Œæœç´¢åŠŸèƒ½
- âœ… æ¸²æŸ“ç»Ÿä¸€çš„ UI å…ƒç´ 

---

### @veaiops/hooks - React Hooks åº“

**ä½œç”¨**: æä¾›å¯å¤ç”¨çš„ä¸šåŠ¡é€»è¾‘ Hooksã€‚

**ä¸»è¦ Hooks**:

| Hook | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `useTableRefresh` | è¡¨æ ¼åˆ·æ–°ç®¡ç† | éœ€è¦æ‰‹åŠ¨åˆ·æ–°è¡¨æ ¼æ•°æ® |
| `useApi` | API è¯·æ±‚å°è£… | ç»Ÿä¸€çš„ API è°ƒç”¨æ–¹å¼ |
| `useConfigManager` | é…ç½®ç®¡ç† | ç®¡ç†é¡µé¢é…ç½®çŠ¶æ€ |

**ç¤ºä¾‹**:

```typescript
import { useTableRefresh } from '@veaiops/hooks';

const MyComponent = () => {
  const { refreshKey, refresh } = useTableRefresh();

  // åˆ·æ–°è¡¨æ ¼
  const handleRefresh = () => {
    refresh();
  };

  return <CustomTable key={refreshKey} />;
};
```

**ä½¿ç”¨åœºæ™¯**:
- âœ… è¡¨æ ¼æ•°æ®åˆ·æ–°
- âœ… é…ç½®çŠ¶æ€ç®¡ç†
- âœ… API è¯·æ±‚å°è£…

---

### @veaiops/types - ç±»å‹å®šä¹‰åº“

**ä½œç”¨**: æä¾›è·¨åŒ…å…±äº«çš„ TypeScript ç±»å‹å®šä¹‰ã€‚

**ä¸»è¦ç±»å‹æ–‡ä»¶**:

| æ–‡ä»¶ | åŒ…å«ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `common.ts` | é€šç”¨ç±»å‹ | BaseResponseã€Pagination ç­‰ |
| `alarm.ts` | å‘Šè­¦ç±»å‹ | Alarmã€AlarmLevelã€AlarmStatus |
| `monitor.ts` | ç›‘æ§ç±»å‹ | Monitorã€Metric ç­‰ |
| `form-item.ts` | è¡¨å•ç±»å‹ | FormItemã€FormConfig |
| `enum-service.ts` | æšä¸¾æœåŠ¡ | å„ç§æšä¸¾ç±»å‹ |
| `module.ts` | æ¨¡å—ç±»å‹ | æ¨¡å—ç›¸å…³ç±»å‹å®šä¹‰ |

**ç¤ºä¾‹**:

```typescript
import type { BaseResponse, Pagination } from '@veaiops/types';

interface DataSourceResponse extends BaseResponse<DataSource[]> {
  pagination: Pagination;
}
```

**ä½¿ç”¨åœºæ™¯**:
- âœ… å®šä¹‰é€šç”¨æ•°æ®ç»“æ„
- âœ… è·¨åŒ…ç±»å‹å…±äº«
- âœ… ä¿è¯ç±»å‹ä¸€è‡´æ€§

---

### @veaiops/utils - å·¥å…·å‡½æ•°åº“

**ä½œç”¨**: æä¾›é€šç”¨çš„å·¥å…·å‡½æ•°å’Œè¾…åŠ©æ–¹æ³•ã€‚

**ä¸»è¦å·¥å…·åˆ†ç±»**:

::tabs
  ::tab{label="æ—¥æœŸæ—¶é—´"}
    ```typescript
    import { formatDate, formatTime } from '@veaiops/utils';

    // æ ¼å¼åŒ–æ—¥æœŸ
    formatDate(new Date()); // "2024-01-01"

    // æ ¼å¼åŒ–æ—¶é—´
    formatTime(timestamp); // "2024-01-01 12:00:00"
    ```
  ::

  ::tab{label="æ ¼å¼åŒ–"}
    ```typescript
    import { formatNumber, formatBytes } from '@veaiops/utils';

    // æ ¼å¼åŒ–æ•°å­—
    formatNumber(1234567); // "1,234,567"

    // æ ¼å¼åŒ–å­—èŠ‚
    formatBytes(1024); // "1 KB"
    ```
  ::

  ::tab{label="API å®¢æˆ·ç«¯"}
    ```typescript
    import { apiClient } from '@veaiops/utils';

    // GET è¯·æ±‚
    const data = await apiClient.get('/api/users');

    // POST è¯·æ±‚
    await apiClient.post('/api/users', { name: 'John' });
    ```
  ::

  ::tab{label="æŸ¥è¯¢å‚æ•°"}
    ```typescript
    import { parseQuery, stringifyQuery } from '@veaiops/utils';

    // è§£ææŸ¥è¯¢å­—ç¬¦ä¸²
    parseQuery('?name=john&age=30');
    // { name: 'john', age: '30' }

    // æ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²
    stringifyQuery({ name: 'john', age: 30 });
    // "name=john&age=30"
    ```
  ::
::

**å·¥å…·æ–‡ä»¶**:
- `tools/date.ts` - æ—¥æœŸå¤„ç†
- `tools/format.ts` - æ ¼å¼åŒ–å·¥å…·
- `tools/time.ts` - æ—¶é—´å¤„ç†
- `tools/query.ts` - æŸ¥è¯¢å‚æ•°
- `tools/table.ts` - è¡¨æ ¼å·¥å…·
- `tools/logger.ts` - æ—¥å¿—å·¥å…·
- `hooks/api-client.ts` - API å®¢æˆ·ç«¯

**ä½¿ç”¨åœºæ™¯**:
- âœ… æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–
- âœ… æ•°æ®æ ¼å¼åŒ–
- âœ… API è¯·æ±‚å°è£…
- âœ… æŸ¥è¯¢å‚æ•°å¤„ç†

---

### @veaiops/constants - å¸¸é‡å®šä¹‰åº“

**ä½œç”¨**: é›†ä¸­ç®¡ç†åº”ç”¨çº§å¸¸é‡,ä¿è¯ä¸€è‡´æ€§ã€‚

**ä¸»è¦å¸¸é‡æ–‡ä»¶**:

```typescript
// api.ts - API ç›¸å…³å¸¸é‡
export const API_ENDPOINTS = {
  BOTS: '/apis/v1/manager/system-config/bots/',
  DATASOURCES: '/apis/v1/datasource/',
  EVENTS: '/apis/v1/event-center/',
};

// datasource.ts - æ•°æ®æºå¸¸é‡
export const DATA_SOURCE_TYPES = {
  ALIYUN: 'Aliyun',
  VOLCENGINE: 'Volcengine',
  ZABBIX: 'Zabbix',
};

// status.ts - çŠ¶æ€å¸¸é‡
export const STATUS = {
  ACTIVE: 'active',
  INACTIVE: 'inactive',
  PENDING: 'pending',
};

// routes.ts - è·¯ç”±å¸¸é‡
export const ROUTES = {
  SYSTEM: '/system',
  EVENT_CENTER: '/event-center',
  THRESHOLD: '/threshold',
};

// color.ts - é¢œè‰²å¸¸é‡
export const COLORS = {
  PRIMARY: '#165DFF',
  SUCCESS: '#00B42A',
  WARNING: '#FF7D00',
  ERROR: '#F53F3F',
};
```

**ä½¿ç”¨åœºæ™¯**:
- âœ… ç»Ÿä¸€ API åœ°å€
- âœ… å®šä¹‰ä¸šåŠ¡å¸¸é‡
- âœ… ç®¡ç†çŠ¶æ€æšä¸¾
- âœ… ç»Ÿä¸€è·¯ç”±è·¯å¾„

---

### @veaiops/openapi-specs - API è§„èŒƒç®¡ç† â­

**ä½œç”¨**: ç®¡ç† OpenAPI è§„èŒƒ,è‡ªåŠ¨ç”Ÿæˆå‰ç«¯ API ä»£ç ã€‚

**ç›®å½•ç»“æ„**:

```
openapi-specs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ specs/
â”‚   â”‚   â”œâ”€â”€ modules/          # æ¨¡å— API è§„èŒƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ bots.json
â”‚   â”‚   â”‚   â”œâ”€â”€ datasource.json
â”‚   â”‚   â”‚   â”œâ”€â”€ event-center.json
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ main.json         # ä¸»è§„èŒƒ
â”‚   â”‚   â””â”€â”€ api-config.json   # API é…ç½®
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ generate-api-complete.js    # å®Œæ•´ç”Ÿæˆè„šæœ¬
â”‚       â”œâ”€â”€ build-openapi.js            # æ„å»º OpenAPI
â”‚       â””â”€â”€ validate-specs.js           # éªŒè¯è§„èŒƒ
â””â”€â”€ package.json
```

**ä¸»è¦åŠŸèƒ½**:

1. **å®šä¹‰ API è§„èŒƒ** - åœ¨ `modules/` ä¸‹å®šä¹‰å„æ¨¡å—çš„ API
2. **ç”Ÿæˆ TypeScript ä»£ç ** - è‡ªåŠ¨ç”Ÿæˆç±»å‹å®šä¹‰å’Œ API æœåŠ¡ç±»
3. **éªŒè¯è§„èŒƒ** - ç¡®ä¿ API è§„èŒƒçš„æ­£ç¡®æ€§

**ä½¿ç”¨æµç¨‹**:

```bash
# 1. å®šä¹‰ OpenAPI spec
# ç¼–è¾‘ specs/modules/your-module.json

# 2. ç”Ÿæˆ API ä»£ç 
pnpm generate:api

# 3. ä½¿ç”¨ç”Ÿæˆçš„ä»£ç 
import { YourService } from 'api-generate';
```

**ä½¿ç”¨åœºæ™¯**:
- âœ… å®šä¹‰åç«¯ API æ¥å£
- âœ… è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹
- âœ… è‡ªåŠ¨ç”Ÿæˆ API å®¢æˆ·ç«¯
- âœ… ä¿è¯å‰åç«¯ç±»å‹ä¸€è‡´

---

### @veaiops/theme-ve-o - ä¸»é¢˜æ ·å¼åº“

**ä½œç”¨**: ç»Ÿä¸€çš„è§†è§‰é£æ ¼å’Œä¸»é¢˜å˜é‡ã€‚

**ä¸»è¦å†…å®¹**:

```less
// ä¸»é¢˜å˜é‡
@primary-color: #165DFF;
@success-color: #00B42A;
@warning-color: #FF7D00;
@error-color: #F53F3F;

// é—´è·
@spacing-xs: 4px;
@spacing-sm: 8px;
@spacing-md: 16px;
@spacing-lg: 24px;

// å­—ä½“å¤§å°
@font-size-sm: 12px;
@font-size-base: 14px;
@font-size-lg: 16px;

// åœ†è§’
@border-radius-sm: 2px;
@border-radius-base: 4px;
@border-radius-lg: 8px;
```

**ä½¿ç”¨æ–¹å¼**:

```less
@import '@veaiops/theme-ve-o';

.my-component {
  color: @primary-color;
  padding: @spacing-md;
  border-radius: @border-radius-base;
}
```

**ä½¿ç”¨åœºæ™¯**:
- âœ… ç»Ÿä¸€è§†è§‰é£æ ¼
- âœ… ä¸»é¢˜å˜é‡ç®¡ç†
- âœ… ç»„ä»¶æ ·å¼å®šåˆ¶

---

### åŒ…ä¾èµ–å…³ç³»å›¾

```
apps/veaiops (ä¸»åº”ç”¨)
  â”œâ”€ @veaiops/components (UI ç»„ä»¶åº“)
  â”‚   â”œâ”€ @veaiops/constants
  â”‚   â””â”€ @veaiops/types
  â”œâ”€ @veaiops/hooks (Hooks åº“)
  â”‚   â””â”€ @veaiops/types
  â”œâ”€ @veaiops/utils (å·¥å…·å‡½æ•°)
  â”‚   â””â”€ @veaiops/constants
  â”œâ”€ @veaiops/types (ç±»å‹å®šä¹‰)
  â”œâ”€ @veaiops/constants (å¸¸é‡å®šä¹‰)
  â””â”€ @veaiops/theme-ve-o (ä¸»é¢˜æ ·å¼)

api-generate (è‡ªåŠ¨ç”Ÿæˆ)
  â””â”€ @veaiops/openapi-specs (ç”Ÿæˆæº)
```

**ä¾èµ–è¯´æ˜**:
- ä¸»åº”ç”¨ä¾èµ–æ‰€æœ‰å…±äº«åŒ…
- ç»„ä»¶åº“ä¾èµ–ç±»å‹å’Œå¸¸é‡åŒ…
- Hooks åº“ä¾èµ–ç±»å‹åŒ…
- å·¥å…·å‡½æ•°ä¾èµ–å¸¸é‡åŒ…
- OpenAPI specs ç”Ÿæˆ API ä»£ç 

---

## æ ¸å¿ƒç»„ä»¶ä½¿ç”¨

VeAIOps æä¾›äº†ä¸°å¯Œçš„ UI ç»„ä»¶,å¸®åŠ©æ‚¨å¿«é€Ÿæ„å»ºç®¡ç†ç•Œé¢ã€‚

### CustomTable - æ ¸å¿ƒè¡¨æ ¼ç»„ä»¶

CustomTable æ˜¯ VeAIOps æœ€æ ¸å¿ƒçš„ç»„ä»¶ä¹‹ä¸€,æä¾›äº†å¼€ç®±å³ç”¨çš„æ•°æ®ç®¡ç†èƒ½åŠ›ã€‚

#### åŸºæœ¬ä½¿ç”¨

```typescript
import { CustomTable } from '@veaiops/components';

const MyTable = () => {
  const columns = [
    { title: 'åç§°', dataIndex: 'name', key: 'name' },
    { title: 'çŠ¶æ€', dataIndex: 'status', key: 'status' },
  ];

  const dataSource = {
    request: async (params) => {
      const response = await fetchData(params);
      return {
        data: response.data,
        total: response.total,
        success: true,
      };
    },
  };

  return <CustomTable dataSource={dataSource} baseColumns={columns} />;
};
```

#### ä½¿ç”¨ useBusinessTable (æ¨è)

`useBusinessTable` æ˜¯å¯¹ CustomTable çš„å¢å¼ºå°è£…,æä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½:

```typescript
import { useBusinessTable } from '@veaiops/components';

const MyTable = ({ onEdit, onDelete }) => {
  const { customTableProps } = useBusinessTable({
    dataSource: { request: fetchData },
    tableProps: { rowKey: 'id' },
    handlers: {
      delete: onDelete,
      update: onEdit,
    },
    refreshConfig: {
      enableRefreshFeedback: true,
      successMessage: 'æ“ä½œæˆåŠŸ',
    },
  });

  return <CustomTable {...customTableProps} />;
};
```

**æ ¸å¿ƒç‰¹æ€§**:
- ğŸ”„ è‡ªåŠ¨åˆ†é¡µç®¡ç†
- âš¡ æ™ºèƒ½åˆ·æ–°æœºåˆ¶
- ğŸ¯ æ“ä½œåŒ…è£…å™¨ (æ”¯æŒ loadingã€é”™è¯¯å¤„ç†)
- ğŸ” ç­›é€‰é›†æˆ
- ğŸ“Š ç”Ÿå‘½å‘¨æœŸé’©å­

### Filters - ç­›é€‰å™¨ç»„ä»¶

Filters æä¾›äº†æ’ä»¶åŒ–çš„ç­›é€‰åŠŸèƒ½,æ”¯æŒå¤šç§ç­›é€‰ç±»å‹ã€‚

#### åŸºæœ¬ä½¿ç”¨

```typescript
import { Filters } from '@veaiops/components';

const filterConfig = [
  {
    field: 'name',
    label: 'åç§°',
    type: 'Input',
    componentProps: { placeholder: 'è¯·è¾“å…¥åç§°' },
  },
  {
    field: 'status',
    label: 'çŠ¶æ€',
    type: 'Select',
    componentProps: {
      options: [
        { label: 'å¯ç”¨', value: 'active' },
        { label: 'ç¦ç”¨', value: 'inactive' },
      ],
    },
  },
  {
    field: 'dateRange',
    label: 'æ—¥æœŸèŒƒå›´',
    type: 'DateRange',
  },
];

<Filters config={filterConfig} query={query} showReset />;
```

**å†…ç½®ç­›é€‰å™¨ç±»å‹**:
- `Input` - æ–‡æœ¬è¾“å…¥
- `Select` - ä¸‹æ‹‰é€‰æ‹©
- `DateRange` - æ—¥æœŸèŒƒå›´
- `Select.Account` - è´¦æˆ·é€‰æ‹©å™¨ (å‘½åç©ºé—´æ ¼å¼)
- `Select.Employee` - å‘˜å·¥é€‰æ‹©å™¨
- æ›´å¤šç±»å‹å¯é€šè¿‡æ’ä»¶æ‰©å±•...

### CellRender - å•å…ƒæ ¼æ¸²æŸ“

æä¾›ç»Ÿä¸€çš„å•å…ƒæ ¼æ¸²æŸ“ç»„ä»¶,ä¿æŒ UI ä¸€è‡´æ€§ã€‚

```typescript
import { CellRender } from '@veaiops/components';

// ä¿¡æ¯å±•ç¤º
<CellRender.InfoWithCode name="åç§°" code="ID-001" />

// æ—¶é—´æˆ³
<CellRender.StampTime time="2024-01-01T00:00:00Z" />

// çœç•¥æ–‡æœ¬
<CellRender.Ellipsis text="å¾ˆé•¿çš„æ–‡æœ¬..." />

// çŠ¶æ€æ ‡ç­¾
<CellRender.CustomOutlineTag>å·²å¯ç”¨</CellRender.CustomOutlineTag>

// çŠ¶æ€ç‚¹
<CellRender.StatusDot status="active" />

// å¤åˆ¶æŒ‰é’®
<CellRender.CopyButton text="å¯å¤åˆ¶çš„æ–‡æœ¬" />
```

---

## å¼€å‘æµç¨‹

### å®Œæ•´å¼€å‘æµç¨‹æ¦‚è§ˆ

VeAIOps å‰ç«¯å¼€å‘éµå¾ªä»¥ä¸‹æ ‡å‡†æµç¨‹:

::steps
**å®šä¹‰ OpenAPI Spec**

åœ¨ `frontend/packages/openapi-specs/src/specs/modules/` ç›®å½•ä¸‹å®šä¹‰ API è§„èŒƒã€‚

**ç”Ÿæˆå‰ç«¯ API ä»£ç **

è¿è¡Œç”Ÿæˆå‘½ä»¤,è‡ªåŠ¨ç”Ÿæˆç±»å‹å®šä¹‰å’Œ API å®¢æˆ·ç«¯ä»£ç ã€‚

**å®ç°ä¸šåŠ¡é€»è¾‘**

åŸºäºç”Ÿæˆçš„ API ä»£ç ,å®ç°ä¸šåŠ¡é€»è¾‘å’Œ UI ç»„ä»¶ã€‚

**æµ‹è¯•å’Œè°ƒè¯•**

ç¡®ä¿åŠŸèƒ½æ­£å¸¸,ä»£ç è´¨é‡è¾¾æ ‡ã€‚
::

### API ä»£ç ç”Ÿæˆ

#### 1. å®šä¹‰ OpenAPI Spec

åœ¨ `frontend/packages/openapi-specs/src/specs/modules/` ç›®å½•ä¸‹åˆ›å»º API è§„èŒƒæ–‡ä»¶ã€‚

**ç¤ºä¾‹: prometheus.json**

```json [frontend/packages/openapi-specs/src/specs/modules/prometheus.json]
{
  "openapi": "3.0.0",
  "info": {
    "title": "Prometheus API",
    "version": "1.0.0",
    "description": "Prometheus æ•°æ®æºç®¡ç†æ¥å£"
  },
  "paths": {
    "/apis/v1/datasource/prometheus/": {
      "get": {
        "summary": "Get All Prometheus Datasources",
        "description": "è·å–æ‰€æœ‰ Prometheus æ•°æ®æº",
        "tags": ["Data Sources"],
        "parameters": [
          {
            "name": "skip",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/PrometheusDataSource"
                      }
                    },
                    "total": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create Prometheus Datasource",
        "description": "åˆ›å»ºæ–°çš„ Prometheus æ•°æ®æº",
        "tags": ["Data Sources"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PrometheusDataSourceCreate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PrometheusDataSource"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "PrometheusDataSource": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["Prometheus"]
          },
          "prometheus_config": {
            "$ref": "#/components/schemas/PrometheusConfig"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "PrometheusConfig": {
        "type": "object",
        "properties": {
          "server_url": {
            "type": "string"
          },
          "query_timeout": {
            "type": "integer"
          }
        }
      },
      "PrometheusDataSourceCreate": {
        "type": "object",
        "required": ["name", "type", "prometheus_config"],
        "properties": {
          "name": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["Prometheus"]
          },
          "prometheus_config": {
            "$ref": "#/components/schemas/PrometheusConfig"
          }
        }
      }
    }
  }
}
```

#### 2. ç”Ÿæˆå‰ç«¯ API ä»£ç 

å®šä¹‰å¥½ OpenAPI spec å,è¿è¡Œç”Ÿæˆå‘½ä»¤:

```bash
cd frontend
pnpm generate:api
```

æ­¤å‘½ä»¤ä¼š:
1. åˆå¹¶æ‰€æœ‰ spec æ–‡ä»¶
2. ç”Ÿæˆ TypeScript ç±»å‹å®šä¹‰
3. ç”Ÿæˆ API æœåŠ¡ç±»
4. è¾“å‡ºåˆ° `frontend/apps/veaiops/api-generate/` ç›®å½•

**ç”Ÿæˆçš„ä»£ç ç»“æ„**:

```
frontend/apps/veaiops/api-generate/
â”œâ”€â”€ core/                    # æ ¸å¿ƒ API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ ApiError.ts
â”‚   â”œâ”€â”€ ApiRequestOptions.ts
â”‚   â”œâ”€â”€ ApiResult.ts
â”‚   â”œâ”€â”€ CancelablePromise.ts
â”‚   â”œâ”€â”€ OpenAPI.ts
â”‚   â””â”€â”€ request.ts
â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ PrometheusDataSource.ts
â”‚   â”œâ”€â”€ PrometheusConfig.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/                # API æœåŠ¡ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ DataSourcesService.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ volc-ai-ops-api.ts      # ç»Ÿä¸€å¯¼å‡º
```

#### 3. ä½¿ç”¨ç”Ÿæˆçš„ API ä»£ç 

ç”Ÿæˆå,å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨:

```typescript
import { DataSourcesService } from 'api-generate';
import type { PrometheusDataSource } from 'api-generate';

// è·å– Prometheus æ•°æ®æºåˆ—è¡¨
const response = await DataSourcesService.getAllPrometheusDatasources({
  skip: 0,
  limit: 10,
});

// åˆ›å»ºæ–°æ•°æ®æº
const newDataSource = await DataSourcesService.createPrometheusDatasource({
  requestBody: {
    name: 'My Prometheus',
    type: 'Prometheus',
    prometheus_config: {
      server_url: 'http://prometheus:9090',
      query_timeout: 30,
    },
  },
});
```

::alert{type="info"}
#title
è‡ªåŠ¨ç±»å‹æ¨å¯¼
#description
ä½¿ç”¨ç”Ÿæˆçš„ API ä»£ç å¯ä»¥è·å¾—å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ,åŒ…æ‹¬è¯·æ±‚å‚æ•°ã€å“åº”æ•°æ®ã€é”™è¯¯å¤„ç†ç­‰,å¤§å¤§æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚
::

---

### è¡¨æ ¼é…ç½®æ¨¡å¼ (æ¨è)

è¿™æ˜¯ VeAIOps æ¨èçš„å¼€å‘æ¨¡å¼,å°†é…ç½®ã€åˆ—å®šä¹‰å’Œç»„ä»¶åˆ†ç¦»,ä»£ç æ›´æ¸…æ™°ã€æ˜“ç»´æŠ¤ã€‚

#### å®Œæ•´ç¤ºä¾‹:æœºå™¨äººç®¡ç†

å‚è€ƒ VeAIOps ç°æœ‰çš„æœºå™¨äººç®¡ç†å®ç°:

**æ­¥éª¤ 1: å®šä¹‰ç±»å‹**

```typescript [lib/types.ts]
/**
 * æœºå™¨äººæ•°æ®ç»“æ„
 */
export interface Bot {
  _id: string;
  bot_id: string;
  name: string;
  channel: 'Lark' | 'DingTalk' | 'WeCom';
  open_id?: string;
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

/**
 * åˆ›å»º/æ›´æ–°æœºå™¨äººçš„è¡¨å•æ•°æ®
 */
export interface BotFormData {
  name: string;
  bot_id: string;
  bot_secret: string;
  channel: string;
  // ... å…¶ä»–å­—æ®µ
}
```

**æ­¥éª¤ 2: é…ç½®è¡¨æ ¼åˆ—**

```typescript [lib/columns.tsx]
import { Button } from '@arco-design/web-react';
import { IconEdit, IconDelete } from '@arco-design/web-react/icon';
import type { ColumnProps } from '@arco-design/web-react/es/Table';
import { CellRender, ButtonGroupRender } from '@veaiops/components';
import type { Bot } from './types';

interface TableColumnsProps {
  onEdit: (bot: Bot) => void;
  onDelete: (botId: string) => void;
}

export const getBotColumns = ({
  onEdit,
  onDelete,
}: TableColumnsProps): ColumnProps<Bot>[] => [
  {
    title: 'App ID',
    dataIndex: 'bot_id',
    key: 'bot_id',
    width: 200,
    ellipsis: true,
  },
  {
    title: 'ç¾¤èŠæœºå™¨äººåç§°',
    dataIndex: 'name',
    key: 'name',
    width: 150,
    render: (name: string, record: Bot) => (
      <CellRender.InfoWithCode name={name} code={record._id} />
    ),
  },
  {
    title: 'Open ID',
    dataIndex: 'open_id',
    key: 'open_id',
    width: 200,
    render: (openId: string) => openId || '-',
  },
  {
    title: 'æ“ä½œ',
    key: 'actions',
    width: 120,
    fixed: 'right' as const,
    render: (_: unknown, record: Bot) => (
      <ButtonGroupRender
        buttonConfigurations={[
          {
            text: 'ç¼–è¾‘',
            visible: true,
            onClick: () => onEdit(record),
            buttonProps: {
              type: 'text',
              size: 'small',
              icon: <IconEdit />,
            },
            tooltip: 'ç¼–è¾‘é…ç½®',
          },
          {
            text: 'åˆ é™¤',
            visible: true,
            supportPopConfirm: true,
            popConfirmTitle: 'ç¡®è®¤åˆ é™¤',
            popConfirmContent: 'ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ',
            onClick: () => onDelete(record._id!),
            buttonProps: {
              type: 'text',
              size: 'small',
              status: 'danger',
              icon: <IconDelete />,
            },
          },
        ]}
      />
    ),
  },
];
```

**æ­¥éª¤ 3: é…ç½®ç­›é€‰å™¨**

```typescript [lib/filters.ts]
import type { FilterConfig } from '@veaiops/components';

export const botFilters: FilterConfig[] = [
  {
    field: 'name',
    label: 'æœºå™¨äººåç§°',
    type: 'Input',
    componentProps: {
      placeholder: 'è¯·è¾“å…¥æœºå™¨äººåç§°',
      allowClear: true,
    },
  },
  {
    field: 'channel',
    label: 'æ¸ é“ç±»å‹',
    type: 'Select',
    componentProps: {
      placeholder: 'è¯·é€‰æ‹©æ¸ é“',
      options: [
        { label: 'é£ä¹¦', value: 'Lark' },
        { label: 'é’‰é’‰', value: 'DingTalk' },
        { label: 'ä¼ä¸šå¾®ä¿¡', value: 'WeCom' },
      ],
      allowClear: true,
    },
  },
];
```

**æ­¥éª¤ 4: åˆ›å»ºè¡¨æ ¼é…ç½® Hook**

```typescript [hooks/use-bot-table-config.ts]
import { useCallback } from 'react';
import { useBusinessTable } from '@veaiops/components';
import { Message } from '@arco-design/web-react';
import { getBots, deleteBot } from '../lib/api';
import { getBotColumns } from '../lib/columns';
import type { Bot } from '../lib/types';

export const useBotTableConfig = ({
  onEdit,
}: {
  onEdit: (bot: Bot) => void;
}) => {
  // API è¯·æ±‚å‡½æ•°
  const request = useCallback(
    async (params: { current: number; pageSize: number; [key: string]: any }) => {
      const { current, pageSize, ...filters } = params;

      const response = await getBots({
        skip: (current - 1) * pageSize,
        limit: pageSize,
        ...filters,
      });

      return {
        data: response.data,
        total: response.total || 0,
        success: true,
      };
    },
    [],
  );

  // åˆ é™¤å¤„ç†
  const handleDelete = useCallback(async (id: string) => {
    try {
      await deleteBot(id);
      Message.success('åˆ é™¤æˆåŠŸ');
      return true;
    } catch (error) {
      Message.error('åˆ é™¤å¤±è´¥');
      return false;
    }
  }, []);

  // ä½¿ç”¨ useBusinessTable
  const { customTableProps } = useBusinessTable({
    dataSource: { request },
    handlers: {
      delete: handleDelete,
    },
    refreshConfig: {
      enableRefreshFeedback: true,
    },
  });

  // è·å–åˆ—é…ç½®
  const columns = useCallback(
    () => getBotColumns({ onEdit, onDelete: handleDelete }),
    [onEdit, handleDelete],
  );

  return {
    ...customTableProps,
    handleColumns: columns,
  };
};
```

**æ­¥éª¤ 5: åˆ›å»ºä¸šåŠ¡é€»è¾‘ Hook**

```typescript [hooks/use-bot-logic.ts]
import { useState, useCallback } from 'react';
import { Form, Message } from '@arco-design/web-react';
import { createBot, updateBot } from '../lib/api';
import type { Bot, BotFormData } from '../lib/types';

export const useBotLogic = (refreshTable?: () => void) => {
  const [form] = Form.useForm();
  const [modalVisible, setModalVisible] = useState(false);
  const [editingBot, setEditingBot] = useState<Bot | null>(null);
  const [loading, setLoading] = useState(false);

  // æ‰“å¼€æ–°å¢å¼¹çª—
  const handleAdd = useCallback(() => {
    setEditingBot(null);
    form.resetFields();
    setModalVisible(true);
  }, [form]);

  // æ‰“å¼€ç¼–è¾‘å¼¹çª—
  const handleEdit = useCallback(
    (bot: Bot) => {
      setEditingBot(bot);
      form.setFieldsValue(bot);
      setModalVisible(true);
    },
    [form],
  );

  // å…³é—­å¼¹çª—
  const handleCancel = useCallback(() => {
    setModalVisible(false);
    setEditingBot(null);
    form.resetFields();
  }, [form]);

  // æäº¤è¡¨å•
  const handleSubmit = useCallback(
    async (values: BotFormData) => {
      setLoading(true);
      try {
        if (editingBot) {
          await updateBot(editingBot._id, values);
          Message.success('æ›´æ–°æˆåŠŸ');
        } else {
          await createBot(values);
          Message.success('åˆ›å»ºæˆåŠŸ');
        }
        handleCancel();
        refreshTable?.();
      } catch (error) {
        Message.error(editingBot ? 'æ›´æ–°å¤±è´¥' : 'åˆ›å»ºå¤±è´¥');
      } finally {
        setLoading(false);
      }
    },
    [editingBot, handleCancel, refreshTable],
  );

  return {
    modalVisible,
    editingBot,
    form,
    loading,
    handleAdd,
    handleEdit,
    handleCancel,
    handleSubmit,
  };
};
```

**æ­¥éª¤ 6: åˆ›å»º UI ç»„ä»¶**

```typescript [ui/bot-table.tsx]
import { forwardRef } from 'react';
import { CustomTable, Filters } from '@veaiops/components';
import { Button, Card } from '@arco-design/web-react';
import { IconPlus } from '@arco-design/web-react/icon';
import { useBotTableConfig } from '../hooks';
import { botFilters } from '../lib/filters';
import type { Bot } from '../lib/types';

interface BotTableProps {
  onEdit: (bot: Bot) => void;
  onAdd: () => void;
}

export const BotTable = forwardRef<any, BotTableProps>((props, ref) => {
  const { onEdit, onAdd } = props;

  const tableConfig = useBotTableConfig({ onEdit });

  return (
    <Card
      title="ç¾¤èŠæœºå™¨äººç®¡ç†"
      extra={
        <Button type="primary" icon={<IconPlus />} onClick={onAdd}>
          æ–°å»ºæœºå™¨äºº
        </Button>
      }
    >
      <Filters config={botFilters} showReset />
      <CustomTable {...tableConfig} ref={ref} rowKey="_id" />
    </Card>
  );
});

BotTable.displayName = 'BotTable';
```

```typescript [ui/bot-management.tsx]
import { useRef } from 'react';
import { BotTable } from './bot-table';
import { BotModal } from './bot-modal';
import { useBotLogic } from '../hooks';

export const BotManagement = () => {
  const tableRef = useRef<any>(null);

  const {
    modalVisible,
    editingBot,
    form,
    loading,
    handleAdd,
    handleEdit,
    handleCancel,
    handleSubmit,
  } = useBotLogic(() => tableRef.current?.refresh());

  return (
    <>
      <BotTable ref={tableRef} onAdd={handleAdd} onEdit={handleEdit} />
      <BotModal
        visible={modalVisible}
        form={form}
        loading={loading}
        isEdit={!!editingBot}
        onCancel={handleCancel}
        onSubmit={handleSubmit}
      />
    </>
  );
};

export default BotManagement;
```

---

## æ‰©å±• Filters æ’ä»¶

Filters ç»„ä»¶é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„,å¯ä»¥è½»æ¾æ‰©å±•æ–°çš„ç­›é€‰ç±»å‹ã€‚

### åˆ›å»ºè‡ªå®šä¹‰ç­›é€‰å™¨æ’ä»¶

å‡è®¾æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª PromQL æŸ¥è¯¢ç­›é€‰å™¨:

```typescript [packages/components/src/filters/plugins/custom/promql.plugin.tsx]
import { Input, Button } from '@arco-design/web-react';
import type { FilterPlugin } from '../../types';

/**
 * PromQL æŸ¥è¯¢ç­›é€‰å™¨æ’ä»¶
 */
export const PromQLPlugin: FilterPlugin = {
  type: 'PromQL',
  name: 'PromQL æŸ¥è¯¢',

  render: ({ hijackedProps, context }) => {
    const handleQuery = () => {
      // æ‰§è¡ŒæŸ¥è¯¢é€»è¾‘
      console.log('PromQL Query:', hijackedProps.value);
    };

    return (
      <Input
        {...hijackedProps}
        placeholder="è¾“å…¥ PromQL æŸ¥è¯¢è¯­å¥"
        addAfter={
          <Button type="primary" onClick={handleQuery}>
            æŸ¥è¯¢
          </Button>
        }
      />
    );
  },

  validateConfig: (config) => typeof config === 'object',
};

// æ³¨å†Œæ’ä»¶
import { filterPluginRegistry } from '../../registry';
filterPluginRegistry.register(PromQLPlugin);
```

### ä½¿ç”¨è‡ªå®šä¹‰ç­›é€‰å™¨

```typescript
const filterConfig = [
  {
    field: 'promql',
    label: 'PromQL æŸ¥è¯¢',
    type: 'PromQL',
    componentProps: {
      placeholder: 'rate(http_requests_total[5m])',
    },
  },
];

<Filters config={filterConfig} query={query} />;
```

### æ‰©å±•ç°æœ‰æ’ä»¶

æ‚¨ä¹Ÿå¯ä»¥æ‰©å±•ç°æœ‰çš„ Select æ’ä»¶,æ·»åŠ æ–°çš„å‘½åç©ºé—´ç±»å‹:

```typescript
// åœ¨ Select æ’ä»¶ä¸­æ·»åŠ æ–°çš„å‘½åç©ºé—´æ”¯æŒ
if (config.type === 'Select.Prometheus') {
  return <PrometheusDataSourceSelect {...hijackedProps} />;
}
```

---

## æœ€ä½³å®è·µ

### ä»£ç ç»„ç»‡

::steps
**éµå¾ªç»Ÿä¸€çš„ç›®å½•ç»“æ„**

æ‰€æœ‰åŠŸèƒ½ç‰¹æ€§éƒ½åº”éµå¾ª `features/[feature-name]/{hooks,lib,ui,types}` çš„ç›®å½•ç»“æ„ã€‚

**å…³æ³¨ç‚¹åˆ†ç¦»**

- `hooks/` - ä¸šåŠ¡é€»è¾‘
- `lib/` - å·¥å…·ã€ç±»å‹ã€é…ç½®
- `ui/` - UI ç»„ä»¶
- `types/` - ç±»å‹å®šä¹‰

**ç»Ÿä¸€å¯¼å‡º**

æ¯ä¸ªç›®å½•éƒ½åº”è¯¥æœ‰ `index.ts` æ–‡ä»¶è¿›è¡Œç»Ÿä¸€å¯¼å‡ºã€‚
::

### ç±»å‹å®‰å…¨

```typescript
// âœ… æ¨è:å®Œæ•´çš„ç±»å‹å®šä¹‰
interface DataSource {
  _id: string;
  name: string;
  type: DataSourceType;
  is_active: boolean;
}

// âœ… ä½¿ç”¨æšä¸¾
enum DataSourceType {
  Prometheus = 'Prometheus',
  Aliyun = 'Aliyun',
  Volcengine = 'Volcengine',
}

// âŒ é¿å…:ä½¿ç”¨ any
const data: any = {};
```

### æ€§èƒ½ä¼˜åŒ–

```typescript
// âœ… ä½¿ç”¨ useMemo ç¼“å­˜é…ç½®
const filterConfig = useMemo(() => prometheusFilters, []);

// âœ… ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°
const handleEdit = useCallback((record) => {
  // ...
}, []);

// âœ… ä½¿ç”¨ React.memo ç¼“å­˜ç»„ä»¶
const MemoizedComponent = React.memo(MyComponent);
```

### é”™è¯¯å¤„ç†

```typescript
// âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
const fetchData = async () => {
  try {
    const response = await api.getData();
    return response.data;
  } catch (error) {
    console.error('Failed to fetch data:', error);
    Message.error('æ•°æ®åŠ è½½å¤±è´¥');
    throw error;
  }
};
```

### æµ‹è¯•

```typescript
// ä¸ºç»„ä»¶ç¼–å†™æµ‹è¯•
describe('PrometheusManagement', () => {
  it('should render correctly', () => {
    render(<PrometheusManagement />);
    expect(screen.getByText('Prometheus æ•°æ®æºç®¡ç†')).toBeInTheDocument();
  });

  it('should handle create action', () => {
    const { getByText } = render(<PrometheusManagement />);
    fireEvent.click(getByText('æ–°å¢æ•°æ®æº'));
    expect(screen.getByText('æ–°å¢ Prometheus æ•°æ®æº')).toBeInTheDocument();
  });
});
```

---

## å¸¸è§é—®é¢˜

::tabs
  ::tab{label="ç¯å¢ƒé…ç½®"}
    ### Q: å¦‚ä½•å¯åŠ¨å¼€å‘ç¯å¢ƒ?

    ```bash
    cd frontend
    pnpm install
    pnpm dev
    ```

    æµè§ˆå™¨è®¿é—® `http://localhost:8080`

    ---

    ### Q: å¦‚ä½•è§£å†³åŒ…å¼•ç”¨é—®é¢˜?

    ç¡®ä¿åœ¨ `tsconfig.base.json` ä¸­é…ç½®äº†è·¯å¾„åˆ«å:

    ```json
    {
      "compilerOptions": {
        "paths": {
          "@veaiops/components": ["packages/components/src/index.ts"]
        }
      }
    }
    ```

    ---

    ### Q: å¦‚ä½•æ¸…é™¤ç¼“å­˜?

    ```bash
    pnpm nx reset
    pnpm clean:cache
    ```
  ::

  ::tab{label="å¼€å‘é—®é¢˜"}
    ### Q: ç»„ä»¶åº”è¯¥æ”¾åœ¨å“ªé‡Œ?

    - **é€šç”¨ç»„ä»¶** â†’ `packages/components/src/`
      - å¯åœ¨å¤šä¸ªåº”ç”¨ä¸­å¤ç”¨
      - ä¸ä¸šåŠ¡é€»è¾‘æ— å…³
    - **ä¸šåŠ¡ç»„ä»¶** â†’ `apps/veaiops/src/modules/[module]/features/[feature]/ui/`
      - ç‰¹å®šä¸šåŠ¡åœºæ™¯ä½¿ç”¨
      - åŒ…å«ä¸šåŠ¡é€»è¾‘

    ---

    ### Q: å¦‚ä½•å¤„ç†æ ·å¼?

    ä½¿ç”¨ CSS Modules:

    ```typescript
    import styles from './index.module.less';

    <div className={styles.container}>
      {/* ... */}
    </div>
    ```

    ä½¿ç”¨ä¸»é¢˜å˜é‡:

    ```less
    @import '@veaiops/theme-ve-o';

    .container {
      color: @primary-color;
      padding: @spacing-md;
    }
    ```

    ---

    ### Q: å¦‚ä½•è°ƒè¯•?

    - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
    - ä½¿ç”¨ React DevTools æ‰©å±•
    - ä½¿ç”¨ `console.log` æˆ– `debugger` æ–­ç‚¹
    - æŸ¥çœ‹ Network é¢æ¿æ£€æŸ¥ API è¯·æ±‚
  ::

  ::tab{label="è¡¨æ ¼é—®é¢˜"}
    ### Q: è¡¨æ ¼ä¸æ˜¾ç¤ºæ•°æ®?

    æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:
    1. API è¿”å›çš„æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®
    2. `dataSource.request` å‡½æ•°æ˜¯å¦æ­£ç¡®è¿”å› `{ data, total, success }`
    3. `rowKey` æ˜¯å¦è®¾ç½®æ­£ç¡®
    4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

    ---

    ### Q: å¦‚ä½•å®ç°è¡¨æ ¼åˆ·æ–°?

    ```typescript
    const tableRef = useRef<any>(null);

    // æ‰‹åŠ¨åˆ·æ–°
    tableRef.current?.refresh();

    // åœ¨ useBusinessTable ä¸­é…ç½®è‡ªåŠ¨åˆ·æ–°
    const { customTableProps } = useBusinessTable({
      dataSource,
      refreshConfig: {
        enableRefreshFeedback: true,
      },
    });
    ```

    ---

    ### Q: å¦‚ä½•è‡ªå®šä¹‰è¡¨æ ¼åˆ—?

    ```typescript
    const columns = [
      {
        title: 'è‡ªå®šä¹‰åˆ—',
        key: 'custom',
        render: (_, record) => (
          <div>
            {/* è‡ªå®šä¹‰æ¸²æŸ“ */}
          </div>
        ),
      },
    ];
    ```
  ::

  ::tab{label="æ„å»ºéƒ¨ç½²"}
    ### Q: å¦‚ä½•æ„å»ºç”Ÿäº§ç‰ˆæœ¬?

    ```bash
    # æ„å»ºæ‰€æœ‰åŒ…
    pnpm build:packages

    # æ„å»ºåº”ç”¨
    pnpm build:apps
    ```

    ---

    ### Q: å¦‚ä½•ä¼˜åŒ–æ„å»ºé€Ÿåº¦?

    - åˆ©ç”¨ Nx çš„ç¼“å­˜æœºåˆ¶
    - åªæ„å»ºå—å½±å“çš„é¡¹ç›®: `pnpm nx affected:build`
    - ä½¿ç”¨å¹¶è¡Œæ„å»º
    - å®šæœŸæ¸…ç†ç¼“å­˜: `pnpm nx reset`

    ---

    ### Q: æ„å»ºå¤±è´¥æ€ä¹ˆåŠ?

    1. æ£€æŸ¥ TypeScript ç±»å‹é”™è¯¯: `pnpm type-check`
    2. æ£€æŸ¥ä»£ç è§„èŒƒ: `pnpm lint`
    3. æ¸…é™¤ç¼“å­˜é‡æ–°æ„å»º
    4. æŸ¥çœ‹æ„å»ºæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
  ::
::

---

## å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [Nx å®˜æ–¹æ–‡æ¡£](https://nx.dev){:target="_blank" rel="noopener noreferrer"}
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev){:target="_blank" rel="noopener noreferrer"}
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org){:target="_blank" rel="noopener noreferrer"}
- [Arco Design](https://arco.design/){:target="_blank" rel="noopener noreferrer"}

### ç¤ºä¾‹ä»£ç 

å‚è€ƒé¡¹ç›®ä¸­çš„ç°æœ‰å®ç°:

- **æœºå™¨äººç®¡ç†**: `frontend/apps/veaiops/src/modules/system/features/bot/`
- **æ•°æ®æºç®¡ç†**: `frontend/apps/veaiops/src/modules/system/features/datasource/`
- **è´¦æˆ·ç®¡ç†**: `frontend/apps/veaiops/src/modules/system/features/account/`
- **äº‹ä»¶ä¸­å¿ƒ**: `frontend/apps/veaiops/src/modules/event-center/`

### ç›¸å…³æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| React | 18+ | UI æ¡†æ¶ |
| TypeScript | 5+ | ç±»å‹ç³»ç»Ÿ |
| Modern.js | æœ€æ–° | Web æ¡†æ¶ |
| Nx | 17+ | Monorepo ç®¡ç† |
| pnpm | 8+ | åŒ…ç®¡ç†å™¨ |
| Arco Design | æœ€æ–° | UI ç»„ä»¶åº“ |
| Less | æœ€æ–° | CSS é¢„å¤„ç†å™¨ |

### å­¦ä¹ è·¯å¾„

::steps
**åˆå­¦è€…**

1. ç†Ÿæ‚‰ Nx Workspace åŸºæœ¬æ¦‚å¿µ
2. å­¦ä¹  CustomTable çš„åŸºç¡€ä½¿ç”¨
3. å°è¯•ä¿®æ”¹ç°æœ‰æ¨¡å—

**è¿›é˜¶å¼€å‘è€…**

1. æŒæ¡è¡¨æ ¼é…ç½®æ¨¡å¼
2. å­¦ä¹  Filters æ’ä»¶æ‰©å±•
3. åˆ›å»ºæ–°çš„åŠŸèƒ½æ¨¡å—

**é«˜çº§å¼€å‘è€…**

1. æ‰©å±• Components åŒ…
2. ä¼˜åŒ–æ€§èƒ½å’Œæ¶æ„
3. è´¡çŒ®æ ¸å¿ƒç»„ä»¶å’Œå·¥å…·
::

---

## æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº† VeAIOps å‰ç«¯ UI æ‰©å±•å¼€å‘çš„å®Œæ•´æµç¨‹,åŒ…æ‹¬:

- âœ… Nx Workspace æ¶æ„å’Œä½¿ç”¨
- âœ… æ¨¡å—åŒ–å¼€å‘è§„èŒƒ
- âœ… CustomTable å’Œ Filters ç»„ä»¶ä½¿ç”¨
- âœ… å®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹ (Prometheus æ•°æ®æº)
- âœ… æœ€ä½³å®è·µå’Œå¸¸è§é—®é¢˜

éµå¾ªæœ¬æŒ‡å—,æ‚¨å¯ä»¥å¿«é€Ÿé«˜æ•ˆåœ°æ‰©å±• VeAIOps çš„ UI åŠŸèƒ½ã€‚å¦‚æœ‰ä»»ä½•é—®é¢˜,è¯·å‚è€ƒç¤ºä¾‹ä»£ç æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚

::alert{type="success"}
#title
ç¥æ‚¨å¼€å‘æ„‰å¿«! ğŸš€
#description
å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿æäº¤ Issue æˆ– Pull Request!
::
